<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.koron.inwlms.mapper.master.leakageControl.AlarmMessageMapper">
  
  <select id="queryAlarmMessage" parameterType="com.koron.inwlms.bean.DTO.leakageControl.WarningInfDTO" resultType="com.koron.inwlms.bean.VO.leakageControl.AlarmMessageVO">
  select c.id as id, c.r_ref as r_ref, c."alarmNum" as "alarmNum", c."warningId" as "warningId", c."alarmType" as "alarmType", c."objectId" as "objectId", c."areaCode" as "areaCode",
  c."objectType" as "objectType", c."createTime" as "createTime", c.content as content, c."createBy" as "createBy", c."alarmTime" as "alarmTime", c."updateBy" as "updateBy",
  c."updateTime" as "updateTime", d."taskCode" as "taskCode", d.state as "taskState" from
  (select a.id as id, a.r_ref as r_ref, a."alarmNum" as "alarmNum", a."warningId" as "warningId", a."alarmType" as "alarmType", a."objectId" as "objectId", a."areaCode" as "areaCode",
  b."objectType" as "objectType", a."createTime" as "createTime", a.content as content, a."createBy" as "createBy", a."alarmTime" as "alarmTime", a."updateBy" as "updateBy",
  a."updateTime" as "updateTime" from
  (select * from "APP_warningInf" where "alarmTime" between '${startTime}' and '${endTime}' 
  <if test="alarmType != null and alarmType != '' "> and "alarmType" = #{alarmType} </if>
  <if test="areaCode != null and areaCode != '' "> and "areaCode" = #{areaCode}</if>
  <if test="objectType != null and objectType != '' "> and "objectType" = #{objectType}</if>
  <if test="objectId != null and objectId != '' "> and "objectId" = #{objectId}</if>
  <if test="orderby != null and orderby != '' "> order by ${orderby}</if>) a inner join "APP_warningScheme" b on a."warningId" = b.id) c inner join "APP_warningProcessing" d on c.id = d."alarmId"
  </select>
  
  
  <select id="queryAlarmMessageByRref" parameterType="java.lang.Integer" resultType="com.koron.inwlms.bean.VO.leakageControl.AlarmMessageVO">
  select * from "APP_warningInf" where r_ref = #{id}
  </select>
  
</mapper>
  